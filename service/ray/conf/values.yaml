# https://github.com/ray-project/kuberay/blob/master/helm-chart/ray-cluster/values.yaml
image:
  repository: rayproject/ray
  #tag: 2.41.0-py312
  tag: 2.41.0-py312-gpu
  pullPolicy: IfNotPresent

head:
  enableInTreeAutoscaling: true
  autoscalerOptions:
  resources:
    limits:
      cpu: "1"
      memory: "2G"
    requests:
      cpu: "1"
      memory: "2G"
  rayStartParams:
    # https://docs.ray.io/en/latest/cluster/kubernetes/user-guides/config.html?utm_source=chatgpt.com#ray-start-parameters
    num-cpus: "0"  # headノードでのジョブの実行を禁止
    num-gpus: "0"  # headノードでのジョブの実行を禁止
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
            - key: eks.amazonaws.com/compute-type
              operator: In
              values:
                - hybrid
worker:
  # NOTE: defaultのworkergroupは削除できないし使い勝手が悪いので使用しない
  groupName: default
  # NOTE: 削除する場合は disabled: true を追加すること。この項目自体を削除してはいけない
  disabled: true
  replicas: 1
  minReplicas: 1
  maxReplicas: 1
  resources:
    limits:
      cpu: "1"
      memory: "1G"
    requests:
      cpu: "1"
      memory: "1G"
  affinity:
    nodeAffinity:
      requiredDuringSchedulingIgnoredDuringExecution:
        nodeSelectorTerms:
          - matchExpressions:
            - key: eks.amazonaws.com/compute-type
              operator: In
              values:
                - hybrid

additionalWorkerGroups:
  nvidia-gpu-workergroup-01:
    #disabled: true
    replicas: 1
    minReplicas: 1
    maxReplicas: 1
    resources:
      limits:
        cpu: "2"
        memory: "6G"
        nvidia.com/gpu: "1"
      requests:
        cpu: "2"
        memory: "6G"
        nvidia.com/gpu: "1"
    affinity:
      nodeAffinity:
        requiredDuringSchedulingIgnoredDuringExecution:
          nodeSelectorTerms:
            - matchExpressions:
              - key: eks.amazonaws.com/compute-type
                operator: In
                values:
                  - hybrid
              - key: nvidia.com/gpu.present
                operator: Exists

service:
  type: NodePort